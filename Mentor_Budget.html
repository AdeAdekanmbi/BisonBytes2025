<!DOCTYPE html>
<html>
  <head>
    <title>MoneyMind Smart Dashboard</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript
      ><link rel="stylesheet" href="assets/css/noscript.css"
    /></noscript>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .custom-expense-group {
        margin-bottom: 1em;
      }

      .custom-expense-group input {
        margin-right: 1em;
      }

      .field-group {
        margin-bottom: 1.5em;
      }

      #uploadMessage {
        font-style: italic;
        font-size: 0.9em;
        margin-top: 0.5em;
        color: #666;
      }
    </style>
  </head>
  <body class="is-preload">
    <div id="page-wrapper">
      <header id="header">
        <h1><a href="index.html">MoneyMind</a></h1>
        <nav id="nav">
          <ul>
            <li class="special">
              <a href="#menu" class="menuToggle"><span>Menu</span></a>
              <div id="menu">
                <ul>
                  <li><a href="index.html">Home</a></li>
                  <li><a href="marketplace.html">Marketplace</a></li>
                  <li><a href="#">Sign Up</a></li>
                  <li><a href="#">Log In</a></li>
                </ul>
              </div>
            </li>
          </ul>
        </nav>
      </header>

      <article id="main">
        <header>
          <h2>Financial Dashboard</h2>
          <p>Track your budget, set goals, and unlock smart insights.</p>
        </header>

        <section class="wrapper style5">
          <div class="inner">
            <ul class="actions fit">
              <li>
                <a href="Mentor_overview.html" class="button fit">Overview</a>
              </li>
              <li>
                <a href="Mentor_Budget.html" class="button primary fit"
                  >Budget</a
                >
              </li>
              <li><a href="Mentor_Goals.html" class="button fit">Goals</a></li>
              <li>
                <a href="Mentor_Smartmatching.html" class="button fit"
                  >Smart Matching</a
                >
              </li>
            </ul>

            <h4><strong>Current Budget</strong></h4>
            <p>
              You're currently on track with your budget. Update your values to
              see your status below.
            </p>

            <canvas
              id="budgetChart"
              width="300"
              height="300"
              style="max-width: 300px; margin: 0 auto 2em; display: block"
            ></canvas>

            <header><h3 class="major">Add Budget Details</h3></header>
            <form id="budgetForm">
              <div class="row gtr-uniform">
                <div class="col-6 col-12-xsmall field-group">
                  <input
                    type="text"
                    name="income"
                    id="income"
                    placeholder="Monthly Income ($)"
                  />
                </div>
                <div class="col-6 col-12-xsmall field-group">
                  <input
                    type="text"
                    name="rent"
                    id="rent"
                    placeholder="Rent/Housing ($)"
                  />
                </div>
                <div class="col-6 col-12-xsmall field-group">
                  <input
                    type="text"
                    name="food"
                    id="food"
                    placeholder="Food/Groceries ($)"
                  />
                </div>
                <div class="col-6 col-12-xsmall field-group">
                  <input
                    type="text"
                    name="transportation"
                    id="transportation"
                    placeholder="Transportation ($)"
                  />
                </div>
                <div class="col-12 field-group">
                  <label><strong>Custom Expenses</strong></label>
                  <div id="customExpenses"></div>
                  <button
                    type="button"
                    class="button small"
                    onclick="addCustomField()"
                  >
                    + Add Custom Field
                  </button>
                </div>
                <div class="col-12 field-group">
                  <textarea
                    name="notes"
                    id="notes"
                    placeholder="Additional Notes or Expenses"
                    rows="4"
                  ></textarea>
                </div>

                <!-- âœ… PDF Upload Section -->
                <div class="col-12 field-group">
                  <label><strong>Upload Bank Statement (PDF)</strong></label>
                  <input type="file" id="bankStatement" accept=".pdf" />
                  <p id="uploadMessage">No file uploaded yet.</p>
                </div>

                <div class="col-12">
                  <ul class="actions">
                    <li>
                      <input
                        type="submit"
                        value="Save Budget Info"
                        class="primary"
                      />
                    </li>
                    <li><input type="reset" value="Reset" /></li>
                  </ul>
                </div>
              </div>
            </form>
          </div>
        </section>
      </article>

      <footer id="footer">
        <ul class="icons">
          <li>
            <a href="#" class="icon brands fa-twitter"
              ><span class="label">Twitter</span></a
            >
          </li>
          <li>
            <a href="#" class="icon brands fa-facebook-f"
              ><span class="label">Facebook</span></a
            >
          </li>
          <li>
            <a href="#" class="icon brands fa-instagram"
              ><span class="label">Instagram</span></a
            >
          </li>
          <li>
            <a href="#" class="icon brands fa-dribbble"
              ><span class="label">Dribbble</span></a
            >
          </li>
          <li>
            <a href="#" class="icon solid fa-envelope"
              ><span class="label">Email</span></a
            >
          </li>
        </ul>
        <ul class="copyright">
          <li>&copy; MoneyMind</li>
          <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
        </ul>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Budget Logic -->
    <script>
      const chartCtx = document.getElementById("budgetChart").getContext("2d");
      const budgetChart = new Chart(chartCtx, {
        type: "doughnut",
        data: {
          labels: [],
          datasets: [
            {
              data: [],
              backgroundColor: [
                "#f56942",
                "#ffc107",
                "#17a2b8",
                "#28a745",
                "#007bff",
                "#6c757d",
              ],
            },
          ],
        },
        options: {
          cutout: "70%",
          plugins: { legend: { display: true, position: "bottom" } },
        },
      });

      const inputFields = ["income", "rent", "food", "transportation", "notes"];
      const fieldMap = {};
      inputFields.forEach((id) => (fieldMap[id] = document.getElementById(id)));

      function addCustomField() {
        const wrapper = document.createElement("div");
        wrapper.classList.add("custom-expense-group");

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Expense Name";
        nameInput.classList.add("custom-name");

        const valueInput = document.createElement("input");
        valueInput.type = "text";
        valueInput.placeholder = "Amount ($)";
        valueInput.classList.add("custom-value");

        wrapper.appendChild(nameInput);
        wrapper.appendChild(valueInput);
        document.getElementById("customExpenses").appendChild(wrapper);
      }

      function updateChart() {
        const income = parseFloat(fieldMap["income"].value) || 0;
        const rent = parseFloat(fieldMap["rent"].value) || 0;
        const food = parseFloat(fieldMap["food"].value) || 0;
        const transportation =
          parseFloat(fieldMap["transportation"].value) || 0;

        const customGroups = document.querySelectorAll(".custom-expense-group");
        const customData = [];
        let customTotal = 0;

        customGroups.forEach((group) => {
          const name = group.querySelector(".custom-name").value.trim();
          const value =
            parseFloat(group.querySelector(".custom-value").value) || 0;
          if (name && value > 0) {
            customData.push({ name, value });
            customTotal += value;
          }
        });

        const spent = rent + food + transportation + customTotal;
        const remaining = Math.max(income - spent, 0);

        const labels = [
          "Rent/Housing",
          "Food",
          "Transportation",
          ...customData.map((c) => c.name),
          "Remaining",
        ];
        const data = [
          rent,
          food,
          transportation,
          ...customData.map((c) => c.value),
          remaining,
        ];

        budgetChart.data.labels = labels;
        budgetChart.data.datasets[0].data = data;
        budgetChart.update();
      }

      // Load saved inputs
      window.addEventListener("load", () => {
        inputFields.forEach((id) => {
          const input = fieldMap[id];
          input.value = localStorage.getItem(`budget-${id}`) || "";
          input.addEventListener("input", () => {
            localStorage.setItem(`budget-${id}`, input.value);
            updateChart();
          });
        });
        updateChart();
      });

      // Save form
      document.getElementById("budgetForm").addEventListener("submit", (e) => {
        e.preventDefault();
        inputFields.forEach((id) => {
          localStorage.setItem(`budget-${id}`, fieldMap[id].value);
        });
        updateChart();
      });

      // âœ… Handle PDF Upload
      const bankStatementInput = document.getElementById("bankStatement");
      const uploadMessage = document.getElementById("uploadMessage");

      bankStatementInput.addEventListener("change", () => {
        const file = bankStatementInput.files[0];
        if (file) {
          if (file.type === "application/pdf") {
            uploadMessage.textContent = `Uploaded: ${file.name}`;
            // Future logic to parse PDF can go here
          } else {
            uploadMessage.textContent = "Please upload a valid PDF file.";
            bankStatementInput.value = "";
          }
        }
      });
    </script>
  </body>
</html>
